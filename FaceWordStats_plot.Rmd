---
title: "FaceWord Project -- plots"
author: "[Haiyang Jin](https://haiyangjin.github.io/)"
date: "`r format(Sys.time(), '%b %d %Y')`"
output:
  html_document:
    df_print: paged
    number_sections: true
    toc: true
    toc_depth: 6
    toc_float: 
      collapsed: true
      smooth_scroll: false
    includes:
      after_body: Utilities/footer.html
---

```{r}
library(cowplot)
hroi_order_pub <- c("RFFA2", "RFFA1", "RLO", "LFFA2", "LFFA1", "LVWFA", "LLO")
roi_order_pub <- c("FFA2", "FFA1", "VWFA", "LO")

vss_colors <- c("#e88b1a", "#e3a65d", # FFA2
                "#d12e11", "#c97263", # FFA1
                "#1107F5", "#6e67f0",# VWFA (blue)
                "#1dd904", "#86db7b") # LO

```
                 "#1107F5", "#534bf2", "#847ff0", "#b0adf0", # VWFA (blue)
                 "#1dd904", "#61d651", "#8fd485", "#add4a7") # LO

```


# Plots

## Univariate analysis
### Intact vs. exchange
```{r}
df_uni_ie <- rbind(mutate(desp_uni_E1_FFA1_ie, Exp = "E1", ROI = "FFA1"),
                   mutate(desp_uni_E1_FFA2_ie, Exp = "E1", ROI = "FFA2"),
                   mutate(desp_uni_E1_VWFA_ie, Exp = "E1", ROI = "VWFA"),
                   mutate(desp_uni_E1_LO_ie, Exp = "E1", ROI = "LO"),
                   mutate(desp_uni_E2_FFA1_ie, Exp = "E2", ROI = "FFA1"),
                   mutate(desp_uni_E2_FFA2_ie, Exp = "E2", ROI = "FFA2"),
                   mutate(desp_uni_E2_VWFA_ie, Exp = "E2", ROI = "VWFA"),
                   mutate(desp_uni_E2_LO_ie, Exp = "E2", ROI = "LO")) %>% 
  mutate(Stimuli = FaceWord,
         HROI = toupper(paste0(substr(Hemisphere, 1, 1), ROI)),
         ROI = factor(ROI, levels = roi_order_pub),
         HROI = factor(HROI, levels = hroi_order_pub),
         Hemisphere = factor(Hemisphere, levels=c("right", "left")))

df_uni_ie_sig <- rbind(mutate(as_tibble(simple_E1_lFFA1_ie), Exp = "E1", ROI = "FFA1", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_lFFA2_ie), Exp = "E1", ROI = "FFA2", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_VWFA_ie), Exp = "E1", ROI = "VWFA", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_lLO_ie), Exp = "E1", ROI = "LO", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_lFFA1_ie), Exp = "E2", ROI = "FFA1", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_lFFA2_ie), Exp = "E2", ROI = "FFA2", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_VWFA_ie), Exp = "E2", ROI = "VWFA", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_lLO_ie), Exp = "E2", ROI = "LO", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_rFFA1_ie), Exp = "E1", ROI = "FFA1", Hemisphere = "right"),
                       mutate(as_tibble(simple_E1_rFFA2_ie), Exp = "E1", ROI = "FFA2", Hemisphere = "right"),
                       mutate(as_tibble(simple_E1_rLO_ie), Exp = "E1", ROI = "LO", Hemisphere = "right"),
                       mutate(as_tibble(simple_E2_rFFA1_ie), Exp = "E2", ROI = "FFA1", Hemisphere = "right"),
                       mutate(as_tibble(simple_E2_rFFA2_ie), Exp = "E2", ROI = "FFA2", Hemisphere = "right"),
                       mutate(as_tibble(simple_E2_rLO_ie), Exp = "E2", ROI = "LO", Hemisphere = "right")) %>% 
  filter(FaceWord != ".") %>% 
  mutate(Stimuli = FaceWord,
         HROI = toupper(paste0(substr(Hemisphere, 1, 1), ROI)),
         ROI = factor(ROI, levels = roi_order_pub),
         HROI = factor(HROI, levels = hroi_order_pub),
         Hemisphere = factor(Hemisphere, levels=c("right", "left")),
         Layout = "intact") %>% 
  select(Exp, Layout, Stimuli, HROI, p.value) 

df_uni_ie <- left_join(df_uni_ie, df_uni_ie_sig) %>% 
  mutate(p.value = if_else(is.na(p.value), 1, p.value),
         Stimuli = as_factor(Stimuli)) 

df_uni_ie$Layout <- fct_relevel(df_uni_ie$Layout, "exchange", after = Inf)

```

```{r}
# function to plot univariate results for single condition
plot_uni_fun <- function(df, exp, stim, is_plot=FALSE, str_plot=""){
  
  plot_uni <- ggplot(filter(df, Exp==exp, Stimuli==stim), 
                     aes(y = emmean, x = HROI,
                         fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
    geom_col(position = "dodge", width = .5) +
    facet_grid( ~ Hemisphere, scales = "free_x", space = "free_x", 
                switch = "x") +
    geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                  show.legend = FALSE, width = 0.25, alpha = .5,
                  position = position_dodge(width=0.5)) +
    coord_cartesian(ylim = c(0, activationUL)) + 
    scale_y_continuous(expand = expansion(mult = c(0, .2))) +
    scale_fill_manual(values = vss_colors) +
    labs(y = "Beta values") +  # set the names for main, x and y axises
    geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
    theme_bw() +
    theme(
      plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
      text = element_text(colour="black", size = 22),
      axis.text = element_text(colour="black"),
      axis.text.x = element_text(size = 22, vjust=-.05),
      axis.title.x = element_blank(), # the size of the texts in plot
      axis.title.y = element_text(size = 22), # the size of the texts in plot
      axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
      axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
      # axis.text.x = element_text(angle = 45, vjust = 0.5),
      legend.position = "none",
      legend.title = element_blank(),
      panel.border = element_blank(),
      panel.grid = element_blank(),
      panel.spacing = unit(2.5, "lines"),
      # remove the facet background color
      strip.text = element_blank(),
      strip.background = element_blank(),
      plot.margin = margin(0.5, 0.5, 0.5, 1, "cm")
    ) +
    NULL
  
  if (is_plot){
    plot_fn <- sprintf('plot_uni_%s_%s%s.pdf', toupper(exp), stim, str_plot)
    ggsave(plot_fn, plot_uni, width = 11, height = 11*.27)
  }
  
  return(plot_uni)
}
```


```{r fig.width=6, fig.asp=0.5}
plot_uni_e1_face_inex <- plot_uni_fun(df_uni_ie, "E1", "faces")
# plot_uni_fun(df_uni_ie, "E1", "faces", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_uni_e1_word_inex <- plot_uni_fun(df_uni_ie, "E1", "words")
# plot_uni_fun(df_uni_ie, "E1", "words", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_uni_e2_en_inex <- plot_uni_fun(df_uni_ie, "E2", "English")
# plot_uni_fun(df_uni_ie, "E2", "English", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_uni_e2_cn_inex <- plot_uni_fun(df_uni_ie, "E2", "Chinese")
# plot_uni_fun(df_uni_ie, "E2", "English", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_grid(plot_uni_e1_face_inex, plot_uni_e1_word_inex, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
# ggsave('plot_uni_E1_inex.pdf', width = 12, height = 12*.55)
```

```{r fig.width=6, fig.asp=0.5}
plot_grid(plot_uni_e2_en_inex, plot_uni_e2_cn_inex, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
# ggsave('plot_uni_E2_inex.pdf', width = 12, height = 12*.55)
```

### Top vs. bottom
```{r}
df_uni_tb <- rbind(mutate(desp_uni_E1_FFA1_tb, Exp = "E1", ROI = "FFA1"),
                   mutate(desp_uni_E1_FFA2_tb, Exp = "E1", ROI = "FFA2"),
                   mutate(desp_uni_E1_VWFA_tb, Exp = "E1", ROI = "VWFA"),
                   mutate(desp_uni_E1_LO_tb, Exp = "E1", ROI = "LO"),
                   mutate(desp_uni_E2_FFA1_tb, Exp = "E2", ROI = "FFA1"),
                   mutate(desp_uni_E2_FFA2_tb, Exp = "E2", ROI = "FFA2"),
                   mutate(desp_uni_E2_VWFA_tb, Exp = "E2", ROI = "VWFA"),
                   mutate(desp_uni_E2_LO_tb, Exp = "E2", ROI = "LO")) %>% 
  mutate(Stimuli = FaceWord,
         HROI = toupper(paste0(substr(Hemisphere, 1, 1), ROI)),
         ROI = factor(ROI, levels = roi_order_pub),
         HROI = factor(HROI, levels = hroi_order_pub),
         Hemisphere = factor(Hemisphere, levels=c("right", "left")))

df_uni_tb_sig <- rbind(mutate(as_tibble(simple_E1_lFFA1_tb), Exp = "E1", ROI = "FFA1", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_lFFA2_tb), Exp = "E1", ROI = "FFA2", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_VWFA_tb), Exp = "E1", ROI = "VWFA", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_lLO_tb), Exp = "E1", ROI = "LO", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_lFFA1_tb), Exp = "E2", ROI = "FFA1", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_lFFA2_tb), Exp = "E2", ROI = "FFA2", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_VWFA_tb), Exp = "E2", ROI = "VWFA", Hemisphere = "left"),
                       mutate(as_tibble(simple_E2_lLO_tb), Exp = "E2", ROI = "LO", Hemisphere = "left"),
                       mutate(as_tibble(simple_E1_rFFA1_tb), Exp = "E1", ROI = "FFA1", Hemisphere = "right"),
                       mutate(as_tibble(simple_E1_rFFA2_tb), Exp = "E1", ROI = "FFA2", Hemisphere = "right"),
                       mutate(as_tibble(simple_E1_rLO_tb), Exp = "E1", ROI = "LO", Hemisphere = "right"),
                       mutate(as_tibble(simple_E2_rFFA1_tb), Exp = "E2", ROI = "FFA1", Hemisphere = "right"),
                       mutate(as_tibble(simple_E2_rFFA2_tb), Exp = "E2", ROI = "FFA2", Hemisphere = "right"),
                       mutate(as_tibble(simple_E2_rLO_tb), Exp = "E2", ROI = "LO", Hemisphere = "right")) %>% 
  filter(FaceWord != ".") %>% 
  mutate(Stimuli = FaceWord,
         HROI = toupper(paste0(substr(Hemisphere, 1, 1), ROI)),
         ROI = factor(ROI, levels = roi_order_pub),
         HROI = factor(HROI, levels = hroi_order_pub),
         Hemisphere = factor(Hemisphere, levels=c("right", "left")),
         Layout = case_when(Exp == "E1" ~ "top",
                            Exp == "E2" ~ "partA")) %>% 
  select(Exp, Layout, Stimuli, HROI, p.value) 

df_uni_tb <- left_join(df_uni_tb, df_uni_tb_sig) %>% 
  mutate(p.value = if_else(is.na(p.value), 1, p.value),
         Stimuli = as_factor(Stimuli)) 

# df_uni_tb$Layout <- fct_relevel(df_uni_tb$Layout, "exchange", after = Inf)

```


```{r fig.width=6, fig.asp=0.5}
plot_uni_e1_face_tb <- plot_uni_fun(df_uni_tb, "E1", "faces")
# plot_uni_fun(df_uni_ie, "E1", "faces", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_uni_e1_word_tb <- plot_uni_fun(df_uni_tb, "E1", "words")
# plot_uni_fun(df_uni_ie, "E1", "words", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_uni_e2_en_tb <- plot_uni_fun(df_uni_tb, "E2", "English")
# plot_uni_fun(df_uni_ie, "E2", "English", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_uni_e2_cn_tb <- plot_uni_fun(df_uni_tb, "E2", "Chinese")
# plot_uni_fun(df_uni_ie, "E2", "English", 1, "_inex")
```

```{r fig.width=6, fig.asp=0.5}
plot_grid(plot_uni_e1_face_tb, plot_uni_e1_word_tb, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
ggsave('plot_uni_E1_tb.pdf', width = 12, height = 12*.55)
```

```{r fig.width=6, fig.asp=0.5}
plot_grid(plot_uni_e2_en_tb, plot_uni_e2_cn_tb, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
ggsave('plot_uni_E2_tb.pdf', width = 12, height = 12*.55)
```



## Decoding
```{r warning=FALSE}
# combine all decoding results

df_decoding <- rbind(mutate(one_decode_agg_E1_FFA1, Exp = "E1", ROI = "FFA1"),
                     mutate(one_decode_agg_E1_FFA2, Exp = "E1", ROI = "FFA2"),
                     mutate(one_decode_agg_E1_VWFA, Exp = "E1", ROI = "VWFA"),
                     mutate(one_decode_agg_E1_LO, Exp = "E1", ROI = "LO"),
                     mutate(one_decode_agg_E2_FFA1, Exp = "E2", ROI = "FFA1"),
                     mutate(one_decode_agg_E2_FFA2, Exp = "E2", ROI = "FFA2"),
                     mutate(one_decode_agg_E2_VWFA, Exp = "E2", ROI = "VWFA"),
                     mutate(one_decode_agg_E2_LO, Exp = "E2", ROI = "LO")) %>% 
  separate(ClassifyPair, c("Stimuli1", "Layout1", "Stimuli2", "Layout2")) %>% 
  mutate(Stimuli1 = if_else(Stimuli1 %in% c("face", "word"), paste0(Stimuli1, "s"), Stimuli1),
         Stimuli2 = if_else(Stimuli2 %in% c("face", "word"), paste0(Stimuli2, "s"), Stimuli2),
         Stimuli = ifelse(Stimuli1 == Stimuli2, Stimuli1, 
                          paste(Stimuli1, Stimuli2, sep = "\nvs.\n")),
         Layout = ifelse(Layout1 == Layout2, Layout1,
                         paste(toTitleCase(Layout1), toTitleCase(Layout2), sep = "\nvs.\n")),
         HROI = toupper(paste0(substr(Hemisphere, 1, 1), ROI)),
         ROI = factor(ROI, levels = roi_order_pub),
         HROI = factor(HROI, levels = hroi_order_pub),
         Hemisphere = factor(Hemisphere, levels=c("right", "left"))) %>% 
  select(-c(Stimuli1, Stimuli2, Layout1, Layout2))

```

```{r}
# function to plot decoding results for single conditions
plot_decoding <- function(df, exp, stim, is_plot=FALSE, str_plot=""){
  
  plot_this <- ggplot(filter(df, Exp==exp, Stimuli==stim), aes(y = mean, x = HROI)) +
    geom_col(aes(fill=ROI), position = "dodge", width = .4) +
    facet_grid( ~ Hemisphere, scales = "free_x", space = "free_x", 
               switch = "x") +
    geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                  show.legend = FALSE, width = 0.25, alpha = .5,
                  position = position_dodge(width=0.9)) +
    geom_hline(yintercept = 0.5, linetype = 5, alpha = 0.5) +  # add the line for 0.5 and 1 (y)
    scale_y_continuous(expand= c(0, 0), breaks = seq(0, 1, .25)) +  # remove the space between columns and x axis
    coord_cartesian(ylim = c(0.4, 1.1)) +
    scale_fill_manual(values = vss_colors[seq(1,8,2)]) +
    labs(y = "Accuracy") +  # set the names for main, x and y axises title = "Intact vs. Exchange", 
    geom_text(aes(label = sig_ast(p)), size = 7, nudge_y = 0.15) + # add starts to the significant columns
    theme_bw() +
    theme(
      plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
      text = element_text(colour="black", size = 22),
      axis.text = element_text(colour="black"),
      # axis.text.x = element_text(face = "bold", size = 16),
      axis.title.x = element_blank(), #text(face = "bold", size = 20), # the size of the texts in plot
      axis.title.y = element_text(vjust = 1.75), # the size of the texts in plot
      axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
      axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
      # axis.text.x = element_text(angle = 45, vjust = 0.5),
      panel.border = element_blank(),
      panel.grid.minor = element_blank(),
      panel.grid.major = element_blank(),
      panel.spacing = unit(2.5, "lines"),
      legend.position = "none",
      
      # remove the facet background color
      strip.text.x = element_blank(),
      strip.text.y = element_blank(),
      strip.background = element_blank(),
      strip.placement = "outside",
      plot.margin = margin(0.5, 0.5, 0.5, 1, "cm")
    ) +
    NULL
  
  if (is_plot){
    plot_fn <- sprintf('plot_decode_%s_%s%s.pdf', toupper(exp), stim, str_plot)
    ggsave(plot_fn, plot_this, width = 9, height = 4.5)
  }
  
  return(plot_this)
}

```


### Intact stimuli only
```{r }
# save the df for intact English vs. intact Chinese
df_intact <- filter(df_decoding, Layout == "intact") %>% 
  mutate(Stimuli = fct_rev(Stimuli))
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_intact_E1 <- plot_decoding(df_intact, "E1", "faces\nvs.\nwords"))
# plot_decoding(df_intact, "E1", "faces\nvs.\nwords", 1)
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_intact_E2 <- plot_decoding(df_intact, "E2", "English\nvs.\nChinese"))
# plot_decoding(df_intact, "E2", "English\nvs.\nChinese", 1)
```


```{r fig.width=4, fig.asp=0.8}
plot_grid(plot_decode_intact_E1, plot_decode_intact_E2, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
# ggsave('plot_decode_intact_only.pdf', width = 10, height = 7)
```

### Intact vs. exchange

```{r fig.width=6, fig.asp=1}
df_inex <- df_decoding %>% 
  filter(str_detect(Stimuli, "vs.", negate = TRUE),
         Layout == "Intact\nvs.\nExchange")
df_inex$Stimuli <- fct_relevel(df_inex$Stimuli, "English", after = Inf)
df_inex$Stimuli <- fct_relevel(df_inex$Stimuli, "Chinese", after = Inf)
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E1_faces_inex <- plot_decoding(df_inex, "E1", "faces"))
# plot_decoding(df_inex, "E1", "faces", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E1_words_inex <- plot_decoding(df_inex, "E1", "words"))
# plot_decoding(df_inex, "E1", "words", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E2_en_inex <- plot_decoding(df_inex, "E2", "English"))
# plot_decoding(df_inex, "E2", "English", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E2_cn_inex <- plot_decoding(df_inex, "E2", "Chinese"))
# plot_decoding(df_inex, "E2", "Chinese", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.8}
plot_grid(plot_decode_E1_faces_inex, plot_decode_E1_words_inex, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
# ggsave('plot_decode_E1_inex.pdf', width = 10, height = 7)
```

```{r fig.width=4, fig.asp=0.8}
plot_grid(plot_decode_E2_en_inex, plot_decode_E2_cn_inex, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
# ggsave('plot_decode_E2_inex.pdf', width = 10, height = 7)
```


### Top vs. bottom
```{r fig.width=6, fig.asp=1}
df_parts <- df_decoding %>% 
  filter(str_detect(Stimuli, "vs.", negate = TRUE),
         Layout != "Intact\nvs.\nExchange") %>% 
  mutate(Stimuli = as_factor(Stimuli))
df_parts$Stimuli <- fct_relevel(df_parts$Stimuli, "English", after = Inf)
df_parts$Stimuli <- fct_relevel(df_parts$Stimuli, "Chinese", after = Inf)
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E1_faces_tb <- plot_decoding(df_parts, "E1", "faces"))
# plot_decoding(df_parts, "E1", "faces", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E1_words_tb <- plot_decoding(df_parts, "E1", "words"))
# plot_decoding(df_parts, "E1", "words", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E2_en_tb <- plot_decoding(df_parts, "E2", "English"))
# plot_decoding(df_parts, "E2", "English", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.5}
(plot_decode_E2_cn_tb <- plot_decoding(df_parts, "E2", "Chinese"))
# plot_decoding(df_parts, "E2", "Chinese", 1, "_inex")
```

```{r fig.width=4, fig.asp=0.8}
plot_grid(plot_decode_E1_faces_tb, plot_decode_E1_words_tb, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
# ggsave('plot_decode_E1_tb.pdf', width = 10, height = 7)
```

```{r fig.width=4, fig.asp=0.8}
plot_grid(plot_decode_E2_en_tb, plot_decode_E2_cn_tb, 
          labels="AUTO",
          ncol=1, label_size = 24,
          hjust=-.7, vjust=1.3)
# ggsave('plot_decode_E2_tb.pdf', width = 10, height = 7)
```

plot_uni_tb_E2 <- ggplot(filter(df_uni_tb_all, Exp=="E2"), aes(y = emmean, x = HROI,
                                                                 fill= interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) +
  facet_grid(Stimuli ~ Hemisphere, scales = "free_x", space = "free_x", 
             switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  # scale_x_discrete(labels = toTitleCase(df_0$Stimuli)) +
  coord_cartesian(ylim = c(0, activationUL)) + 
  scale_y_continuous(expand = expansion(mult = c(0, .2))) +
  scale_fill_manual(values = vss_colors) +
  labs(y = "Beta values") +  # set the names for main, x and y axises title = "Top vs. Bottom; Left vs. Right", 
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  # geom_text(aes(label = round(mean, 2)), size = 4, nudge_y = 0.2) +
  # geom_text(data = dat_text_inex_all, mapping = aes(x = x, y = y, label = label), size = 7, fontface = "bold", hjust=0) +
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "none",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
NULL

# ggsave('plot_uni_E2_tb.pdf', plot_uni_tb_E2, width = 11, height = 11*.55)
plot_uni_tb_E2
```


```{r fig.width=8, fig.asp=.75}

plot_uni_tb_lr <- ggarrange(plot_uni_inex_E1, plot_uni_inex_E2, ncol = 2, 
                              labels = c("A", "B"),
                              # label.x = -0.6,
                              # label.y = 1,
                              font.label = list(size = 24))

# ggsave('plot_uni_all_tb_lr.pdf', plot_uni_tb_lr, width = 22, height = 22*.55)
plot_uni_tb_lr
```

## ROI area
### Univariate 

```{r}

```



### Decoding



## For manuscript

### Color

```{r fig.width=8, fig.asp=.75}

plot_uni_E1 <- ggarrange(plot_uni_inex_E1, plot_uni_tb_E1, ncol = 2, 
                         labels = c("A", "B"),
                         # label.x = -0.6,
                         # label.y = 1,
                         font.label = list(size = 24))

# ggsave('plot_uni_E1.pdf', plot_uni_E1, width = 22, height = 10)
plot_uni_E1
```


```{r fig.width=8, fig.asp=.75}

plot_uni_E2 <- ggarrange(plot_uni_inex_E2, plot_uni_tb_E2, ncol = 2, 
                         labels = c("A", "B"),
                         # label.x = -0.6,
                         # label.y = 1,
                         font.label = list(size = 24))

# ggsave('plot_uni_E2.pdf', plot_uni_E2, width = 22, height = 10)
plot_uni_E2
```


## For VSS2021
```{r}
# vss_colors <- c("#e3eb00", "#ecf081", # FFA2
#                 "#e88b1a", "#e3a65d", # FFA1
#                 "#1dd904", "#86db7b", # VWFA (green) "#20e307"
#                 # "#1107F5", "#6e67f0",# VWFA (blue)
#                 "#d12e11", "#c97263") # LO

# vss_colors <- c("#e88b1a", "#e3a65d", # FFA2
#                 "#d12e11", "#c97263", # FFA1
#                 "#1107F5", "#6e67f0",# VWFA (blue)
#                 "#1dd904", "#86db7b") # LO

```

```{r fig.width=5, fig.asp=.618}

vssplot_uni_face_ie_E1 <- ggplot(filter(df_uni_ie, Exp=="E1", Stimuli=="faces"), 
                            aes(y = emmean, x = HROI, 
                                fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  facet_grid( ~ Hemisphere, scales = "free_x", space = "free_x",
             switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) + 
  scale_y_continuous(lim = c(0, activationUL), expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
NULL
vssplot_uni_face_ie_E1
# ggsave("vss_plot_uni_ie_face_E1.pdf", vssplot_uni_face_ie_E1, width = 11, height=11*.35)
```

```{r fig.width=5, fig.asp=.618}
vssplot_uni_word_ie_E1 <- ggplot(filter(df_uni_ie, Exp=="E1", Stimuli=="words"), 
                            aes(y = emmean, x = HROI, 
                                fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  facet_grid( ~ Hemisphere, scales = "free_x", space = "free_x",
             switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  scale_y_continuous(lim = c(0, activationUL), expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
  NULL
vssplot_uni_word_ie_E1
# ggsave("vss_plot_uni_ie_word_E1.pdf", vssplot_uni_word_ie_E1, width = 11, height=11*.35)
```

```{r fig.width=4, fig.asp=.618}

vssplot_uni_face_tb_E1 <- ggplot(filter(df_uni_ie, Exp=="E1", Stimuli=="faces"), 
                            aes(y = emmean, x = HROI, 
                                fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  # facet_grid(Stimuli ~ Hemisphere, scales = "free_x", space = "free_x",
  #            switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  scale_y_continuous(lim = c(0, activationUL), expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
  NULL
vssplot_uni_face_tb_E1
# ggsave("vss_plot_uni_tb_face_E1.pdf", vssplot_uni_face_tb_E1, width = 6.2, height=11*.35)
```

```{r fig.width=4, fig.asp=.618}

vssplot_uni_tb_word_E1 <- ggplot(filter(df_uni_ie, Exp=="E1", Stimuli=="words"), 
                            aes(y = emmean, x = HROI, 
                                fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  # facet_grid(Stimuli ~ Hemisphere, scales = "free_x", space = "free_x",
  #            switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  scale_y_continuous(lim = c(0, activationUL), expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
  NULL
vssplot_uni_tb_word_E1
# ggsave("vss_plot_uni_tb_word_E1.pdf", vssplot_uni_tb_word_E1, width = 6.2, height=11*.35)
```

```{r fig.width=5, fig.asp=.618}

vssplot_uni_en_ie_E2 <- ggplot(filter(df_uni_ie, Exp=="E2", Stimuli=="English"), 
                            aes(y = emmean, x = HROI, 
                                fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  facet_grid( ~ Hemisphere, scales = "free_x", space = "free_x",
             switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  scale_y_continuous(lim = c(0, activationUL), expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
NULL
vssplot_uni_en_ie_E2
# ggsave("vss_plot_uni_ie_en_E2.pdf", vssplot_uni_en_ie_E2, width = 11, height=11*.35)
```

```{r fig.width=5, fig.asp=.618}

vssplot_uni_cn_ie_E2 <- ggplot(filter(df_uni_ie, Exp=="E2", Stimuli=="Chinese"), 
                            aes(y = emmean, x = HROI, 
                                fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  facet_grid( ~ Hemisphere, scales = "free_x", space = "free_x",
             switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  scale_y_continuous(lim = c(0, activationUL), expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
NULL
vssplot_uni_cn_ie_E2
# ggsave("vss_plot_uni_ie_cn_E2.pdf", vssplot_uni_cn_ie_E2, width = 11, height=11*.35)
```


```{r fig.width=4, fig.asp=.618}

vssplot_uni_en_tb_E2 <- ggplot(filter(df_uni_ie, Exp=="E2", Stimuli=="English"), 
                            aes(y = emmean, x = HROI, 
                                fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  # facet_grid(Stimuli ~ Hemisphere, scales = "free_x", space = "free_x",
  #            switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  scale_y_continuous(lim = c(0, activationUL), expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
  NULL
vssplot_uni_en_tb_E2
# ggsave("vss_plot_uni_tb_en_E2.pdf", vssplot_uni_en_tb_E2, width = 6.2, height=11*.35)
```

```{r fig.width=4, fig.asp=.618}

vssplot_uni_cn_tb_E2 <- ggplot(filter(df_uni_ie, Exp=="E2", Stimuli=="Chinese"), 
                               aes(y = emmean, x = HROI, 
                                   fill = interaction(ROI, Layout, sep="-", lex.order = T))) +
  geom_col(position = "dodge", width = .5) + # , fill = "#CDCDC8"
  scale_fill_manual(values = vss_colors) +
  # facet_grid(Stimuli ~ Hemisphere, scales = "free_x", space = "free_x",
  #            switch = "x") +
  geom_errorbar(mapping = aes(ymin = lower.CL, ymax = upper.CL), linetype = 1,  # set the error bar
                show.legend = FALSE, width = 0.25, alpha = .5,
                position = position_dodge(width=0.5)) +
  coord_cartesian(ylim = c(0, activationUL)) +
  scale_y_continuous(expand = expansion(mult = c(0, .2))) +
  labs(y = "Beta values") +  # set the names for main, x and y axis
  geom_text(aes(label = sig_ast(p.value)), size = 7, nudge_y = 0.65) + # add starts to the significant columns
  theme_bw() +
  theme(
    plot.title = element_text(lineheight=.8, face="bold", size = 24, hjust = 0.5, vjust = -1),
    text = element_text(colour="black", size = 22),
    axis.text = element_text(colour="black"),
    axis.text.x = element_text(size = 22, vjust=-.05),
    axis.title.x = element_blank(), # the size of the texts in plot
    axis.title.y = element_text(size = 22), # the size of the texts in plot
    axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
    axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), # , arrow = arrow(length = unit(0.3, "cm"))
    # axis.text.x = element_text(angle = 45, vjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.border = element_blank(),
    panel.grid = element_blank(),
    panel.spacing = unit(2.5, "lines"),
    # remove the facet background color
    strip.text = element_blank(),
    strip.background = element_blank(),
  ) +
  NULL
vssplot_uni_cn_tb_E2
# ggsave("vss_plot_uni_tb_cn_E2.pdf", vssplot_uni_cn_tb_E2, width = 6.2, height=11*.35)
```


# Versions of packages used
```{r versions}
# rstudioapi::versionInfo()
sessionInfo()
```
